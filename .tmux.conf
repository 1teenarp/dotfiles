# --- GENERAL SETTINGS ---
set -g mouse on                  # Mouse support
set -g history-limit 100000      # More scrollback

set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'

# --- PREFIX ---
unbind C-b
set -g prefix C-a                # Use Ctrl+a instead of Ctrl+b
bind C-a send-prefix

# --- SPLITS ---
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# --- SWITCH PANES WITH ALT-ARROWS ---
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# --- WINDOW NAVIGATION ---
bind -n C-Left previous-window
bind -n C-Right next-window

# --- STATUS BAR ---
set -g status-style "bg=#1e1e2e,fg=#cdd6f4"
set -g status-position top
set -g status-bg black
set -g status-fg white
set -g status-interval 2
set -g status-left "#[fg=#2e3440,bg=#5e81ac,bold]  #S #[fg=#5e81ac,bg=#2e3440]\ue0b0"
#set -g status-left "#[bold] #S #[default]"
set -g status-right "#[fg=#a3be8c,bg=#2e3440]\ue0b2#[fg=#2e3440,bg=#a3be8c,bold] Û∞Åπ #(pmset -g batt | grep -o '[0-9]*%%' | head -1) #[fg=#5e81ac,bg=#a3be8c]\ue0b2#[fg=#d8dee9,bg=#5e81ac] %b %d #[fg=#88c0d0,bg=#5e81ac]\ue0b2#[fg=#2e3440,bg=#88c0d0,bold] %H:%M "
#set -g status-right "#[fg=green]%Y-%m-%d #[fg=cyan]%H:%M"
set-option -g status-right "#{weather}"


# Inactive windows
# Transition from black to grey, then grey back to black
setw -g window-status-format "#[fg=black,bg=#3b4252]\ue0b0#[fg=#d8dee9,bg=#3b4252] #I #W #[fg=#3b4252,bg=black]\ue0b0"

# Active window
# Transition from black to blue/cyan, then blue/cyan back to black
setw -g window-status-current-format "#[fg=black,bg=#81a1c1]\ue0b0#[fg=#2e3440,bg=#81a1c1,bold] #I #W #[fg=#81a1c1,bg=black]\ue0b0"

# Inactive windows
# setw -g window-status-format "#[fg=#2e3440,bg=#3b4252]\ue0b0#[fg=#d8dee9,bg=#3b4252] #I #W #[fg=#3b4252,bg=#2e3440]\ue0b0"

# Active window (cyan highlight)
# setw -g window-status-current-format "#[fg=#2e3440,bg=#88c0d0]\ue0b0#[fg=#2e3440,bg=#88c0d0,bold] #I #W #[fg=#88c0d0,bg=#2e3440]\ue0b0"

# --- VI MODE ---
set-option -g set-clipboard on
setw -g mode-keys vi

# Set clipboard command based on OS
if-shell "uname | grep -q Darwin" \
    'set -g @copy_cmd "pbcopy"' \
    'set -g @copy_cmd "xclip -selection clipboard"'

# Copy bindings using variables
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "#{@copy_cmd}"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "#{@copy_cmd}"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "#{@copy_cmd}"

# --- CAPTURE ---
# capture entire pane
# bind-key C-c capture-pane -S -

# capture N preceeding lines
bind-key C-s command-prompt -p "Lines to capture:" "capture-pane -S -%1"

# save buffer to file
bind-key C-f command-prompt -p "Save as:" "save-buffer ~/.clipboard/%1"

# save buffer with timestamp to memory dir (create if not exists)
# bind-key C-s run-shell 'mkdir -p ~/.memory/tmux && tmux save-buffer ~/.memroy/tmux/$(date +%Y%m%d_%H%M%S)_$(uuidgen | cut -d- -f1).md'

# save with timestamp to memory dir (create if not exists)
# bind-key C-a run-shell 'mkdir -p ~/.memory/tmux && tmux capture-pane -S - && tmux save-buffer ~/.memroy/tmux/$(date +%Y%m%d_%H%M%S)_$(uuidgen | cut -d- -f1).md'


# --- TPM PLUGINS ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @plugin 'xamut/tmux-weather'


# --- CONTINUUM ---
set -g @continuum-restore 'on'
set -g @continuum-save-interval '5'
set -g @continuum-boot 'on'


# run '~/.tmux/plugins/tpm/tpm'
# run '~/.tmux/sidebar/sidebar.tmux'

